import"./Bzak7iHL.js";import"./DCkHr_dH.js";import{am as A,h as _,a as y,M as N,an as q,l as S,C as G,G as V,ao as M,ap as P,X as E,s as U,W as B,g,U as F,aq as t,ar as C,V as x,as as p,at as o,au as J}from"./D84Mj3Yo.js";function e(h,k,i=!1,l=!1,d=!1){var r=h,c="";A(()=>{var u=N;if(c===(c=k()??"")){_&&y();return}if(u.nodes_start!==null&&(q(u.nodes_start,u.nodes_end),u.nodes_start=u.nodes_end=null),c!==""){if(_){S.data;for(var n=y(),f=n;n!==null&&(n.nodeType!==G||n.data!=="");)f=n,n=V(n);if(n===null)throw M(),P;E(S,f),r=U(n);return}var a=c+"";i?a=`<svg>${a}</svg>`:l&&(a=`<math>${a}</math>`);var s=B(a);if((i||l)&&(s=g(s)),E(g(s),s.lastChild),i||l)for(;g(s);)r.before(g(s));else r.before(s)}})}const W={title:"How to add email verification to your Go app",topic:"Validation",imgUrl:"/post-images/go-email-banner.png",publishedAt:"2025-10-23"},{title:$,topic:z,imgUrl:K,publishedAt:X}=W;var D=F('<h2>Introduction</h2> <p>In this blog, we will explore how to build an email verification system using Go. This focuses on validating the existence and format of email addresses. And then how to send an Email Verification for an account registration.</p> <h4>Request struct</h4> <p>We begin by using our user struct such as:</p> <pre class="language-go"><!></pre> <p>Here we are doing a simple validation such as require all three fields and enforce a minimum password length. In order to do a more complete validation we need to first install the validation package.</p> <pre class="language-bash"><!></pre> <br/> <p>And then we can simply instantiate and use its method.</p> <pre class="language-go"><!></pre> <p>We are validating the email sent, checking if its a valid email and suggesting if there is a common typo.</p> <br/> <h3>Sending Email Verification</h3> <p>Now that we’ve validated the email address, now we need to send a verification email to confirm the user owns that email. This is important to prevent fake registrations.</p> <p>We will need to:</p> <ol><li>Generate a unique verification token</li> <li>Store it in the database with an expiration time</li> <li>Send an email with a verification link</li> <li>Handle the verification callback when users click the link <br/></li></ol> <h4>Verification token</h4> <p>First of all we need to define the verification token, for that we would use the encoding/hex package to create a random token.</p> <pre class="language-go"><!></pre> <p>We are simply defining an array of bytes and encoding it using the <a href="https://en.wikipedia.org/wiki/SHA-2" rel="nofollow">SHA256</a> algorithm to hash it.</p> <br/> <h4>Storing token</h4> <p>After creating the token and hashing it we would instantiate the model with the data. (we have an “active” field where by default its false and we set it to true after we verify the account).</p> <pre class="language-go"><!></pre> <br/> <h4>Sending the verification link</h4> <p>The route for account verification would be something like this.</p> <pre class="language-go"><!></pre> <br/> <p>After storing the verification hash into the user model we need to send the email and create the link to verify the account using the email and the token.</p> <pre class="language-go"><!></pre> <br/> <h4>Verified account</h4> <p>Finally we handle the user’s verification with the respective service and handler.</p> <pre class="language-go"><!></pre> <pre class="language-go"><!></pre> <br/> <h3>Check the whole code</h3> <p>See the whole implementation <a href="https://github.com/rober0xf/notifier/commit/c913c3b6102563a01c495835697e994b2c99f97b" rel="nofollow">commit</a></p>',1);function Y(h){var k=D(),i=t(C(k),8),l=p(i);e(l,()=>`<code class="language-go"><span class="token keyword">type</span> CreateUserRequest <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	Username <span class="token builtin">string</span> <span class="token string">&#96;json:"username" binding:"required"&#96;</span>
	Email    <span class="token builtin">string</span> <span class="token string">&#96;json:"email" binding:"required,email"&#96;</span>
	Password <span class="token builtin">string</span> <span class="token string">&#96;json:"password" binding:"required,min=6"&#96;</span>
<span class="token punctuation">&#125;</span></code>`),o(i);var d=t(i,4),r=p(d);e(r,()=>'<code class="language-bash">go get github.com/AfterShip/email-verifier </code>'),o(d);var c=t(d,6),u=p(c);e(u,()=>`<code class="language-go"><span class="token comment">// initialize the email verifier with domain suggestion enabled</span>
<span class="token keyword">var</span> verifier <span class="token operator">=</span> emailverifier<span class="token punctuation">.</span><span class="token function">NewVerifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EnableDomainSuggest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> verifier<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>Email<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"failed to verify email"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ret<span class="token punctuation">.</span>Syntax<span class="token punctuation">.</span>Valid <span class="token punctuation">&#123;</span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"invalid email format"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ret<span class="token punctuation">.</span>HasMxRecords <span class="token punctuation">&#123;</span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"email domain cannot receive emails"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">if</span> ret<span class="token punctuation">.</span>Suggestion <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span>
        <span class="token string">"error"</span><span class="token punctuation">:</span>      <span class="token string">"invalid email address"</span><span class="token punctuation">,</span>
        <span class="token string">"suggestion"</span><span class="token punctuation">:</span> ret<span class="token punctuation">.</span>Suggestion<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
<span class="token punctuation">&#125;</span></code>`),o(c);var n=t(c,18),f=p(n);e(f,()=>`<code class="language-go">b <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
<span class="token punctuation">&#125;</span>
verification_token <span class="token operator">:=</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
verification_token_hash <span class="token operator">:=</span> sha256<span class="token punctuation">.</span><span class="token function">Sum256</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>verification_token<span class="token punctuation">)</span><span class="token punctuation">)</span></code>`),o(n);var a=t(n,10),s=p(a);e(s,()=>`<code class="language-go">user <span class="token operator">:=</span> <span class="token operator">&amp;</span>domain<span class="token punctuation">.</span>User<span class="token punctuation">&#123;</span>
    Username<span class="token punctuation">:</span>              username<span class="token punctuation">,</span>
    Email<span class="token punctuation">:</span>                 email<span class="token punctuation">,</span>
    Password<span class="token punctuation">:</span>              hashed<span class="token punctuation">,</span>
    Active<span class="token punctuation">:</span>                <span class="token boolean">false</span><span class="token punctuation">,</span>
    EmailVerificationHash<span class="token punctuation">:</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>verification_token_hash<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    CreatedAt<span class="token punctuation">:</span>             time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"2006-01-02"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Timeout<span class="token punctuation">:</span>               expires_at<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>RFC3339<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code>`),o(a);var m=t(a,8),H=p(m);e(H,()=>'<code class="language-go">public<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/email_verification/:email/:hash"</span><span class="token punctuation">,</span> userHandler<span class="token punctuation">.</span>GetVerificationEmail<span class="token punctuation">)</span></code>'),o(m);var v=t(m,6),R=p(v);e(R,()=>`<code class="language-go">url <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"http://localhost:3000/v1/users/email_verification/%s/%s"</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>Email<span class="token punctuation">,</span> verification_token<span class="token punctuation">)</span>
HTMLBody <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&#96;
    &lt;html>
        &lt;body>
            &lt;h1>Email verification&lt;/h1>
            &lt;p>click the link to verify:&lt;/p>
            &lt;a href="%s">verify account&lt;/a>
        &lt;/body>
    &lt;/html>
&#96;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
ms <span class="token operator">:=</span> mail<span class="token punctuation">.</span><span class="token function">NewMailSender</span><span class="token punctuation">(</span>
    database<span class="token punctuation">.</span><span class="token function">GetEnvOrFatal</span><span class="token punctuation">(</span><span class="token string">"SMTP_HOST"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    database<span class="token punctuation">.</span><span class="token function">GetEnvOrFatal</span><span class="token punctuation">(</span><span class="token string">"SMTP_PORT"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    database<span class="token punctuation">.</span><span class="token function">GetEnvOrFatal</span><span class="token punctuation">(</span><span class="token string">"SMTP_USERNAME"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    database<span class="token punctuation">.</span><span class="token function">GetEnvOrFatal</span><span class="token punctuation">(</span><span class="token string">"SMTP_PASSWORD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">:=</span> mail<span class="token punctuation">.</span><span class="token function">SendMail</span><span class="token punctuation">(</span>ms<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span>user<span class="token punctuation">.</span>Email<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">"verify account"</span><span class="token punctuation">,</span> HTMLBody<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"error sending email verification: %w"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code>`),o(v);var w=t(v,8),O=p(w);e(O,()=>`<code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>Service<span class="token punctuation">)</span> <span class="token function">GetVerificationEmail</span><span class="token punctuation">(</span>email <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>domain<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	user<span class="token punctuation">,</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>Repo<span class="token punctuation">.</span><span class="token function">GetUserByEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// ensure we activate</span>
	user<span class="token punctuation">.</span>Active <span class="token operator">=</span> <span class="token boolean">true</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> s<span class="token punctuation">.</span>Repo<span class="token punctuation">.</span><span class="token function">SetActive</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> dto<span class="token punctuation">.</span>ErrActivating
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> user<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span></code>`),o(w);var b=t(w,2),T=p(b);e(T,()=>`<code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>userHandler<span class="token punctuation">)</span> <span class="token function">GetVerificationEmail</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	email <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"email"</span><span class="token punctuation">)</span>
	hash_str <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> email <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> hash_str <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"invalid verification link"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>
	user<span class="token punctuation">,</span> err <span class="token operator">:=</span> h<span class="token punctuation">.</span>UserService<span class="token punctuation">.</span><span class="token function">GetVerificationEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	user<span class="token punctuation">.</span>Password <span class="token operator">=</span> <span class="token string">""</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"email verified successfully"</span><span class="token punctuation">,</span> <span class="token string">"user"</span><span class="token punctuation">:</span> user<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code>`),o(b),J(6),x(h,k)}export{Y as default,W as metadata};
